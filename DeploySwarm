---
- name: Pre-configuration
  hosts: raspberries
  become: true
  remote_user: pi
  roles:
    - change_hostname
    - interfaces
    - packages
    - docker

- name: Setting up leader
  hosts: manager
  remote_user: pi
  roles:
    - install_compose
    - swarm_init

- name: Adding workers
  hosts: workers
  remote_user: pi
  roles:
    - swarm_add_worker

- name: Setting up exporters
  hosts: workers
  remote_user: pi
  become: true
  roles:
    - Node_exporter

- name: Rebooting all hosts
  hosts: raspberries
  become: true
  remote_user: pi
  roles:
    - reboot